<div>
  <h1 class="text-3xl font-bold mb-6 text-center text-primary">Create Your Blog</h1>
  <form id="title-form" class="space-y-4 mb-6">
    <div>
      <label for="title-input" class="block text-sm font-medium text-base-content mb-1">Title</label>
      <input type="text" class="input input-bordered w-full" id="title-input" placeholder="Enter your blog title" />
    </div>
    <div>
      <label for="description-input" class="block text-sm font-medium text-base-content mb-1">Description</label>
      <input type="text" class="input input-bordered w-full" id="description-input" placeholder="Brief description of your blog" />
    </div>
    <div>
      <label for="category-input" class="block text-sm font-medium text-base-content mb-1">Category</label>
      <input type="text" class="input input-bordered w-full" id="category-input" placeholder="Blog category" />
    </div>
    <button id="save-blog" class="btn btn-primary">Save</button>
  </form>
  <div id="editor"></div>
  <script src="/js/highlight.js"></script>
  <script src="/js/quill.js"></script>
  <script>
    // check if the url has an id
    const url = new URL(window.location.href);
    const id = url.searchParams.get('id');
    if (id) {
      document.addEventListener('DOMContentLoaded', function() {
        var quill = new Quill('#editor', {
          theme: 'snow',
          modules: {
            'syntax': true,
            'toolbar': [
              [{
                'font': []
              }, {
                'size': []
              }],
              ['bold', 'italic', 'underline', 'strike'],
              [{
                'color': []
              }, {
                'background': []
              }],
              [{
                'script': 'super'
              }, {
                'script': 'sub'
              }],
              [{
                'header': '1'
              }, {
                'header': '2'
              }, 'blockquote', 'code-block'],
              [{
                'list': 'ordered'
              }, {
                'list': 'bullet'
              }, {
                'indent': '-1'
              }, {
                'indent': '+1'
              }],
              ['direction', {
                'align': []
              }],
              ['link', 'image', 'video', 'formula'],
              ['clean']
            ],
          },
        });
      });
    }
  </script>
</div>
<!-- make a script to save the form  -->
<script>
  document.getElementById('save-blog').addEventListener('click', async function(e) {
    e.preventDefault();
    const title = document.getElementById('title-input').value;
    const description = document.getElementById('description-input').value;
    const category = document.getElementById('category-input').value;
    
    // Check if Quill editor exists before trying to get its content
    const quillEditor = document.querySelector('.ql-editor');
    const content = quillEditor ? quillEditor.innerHTML : '';

    const token = localStorage.getItem('token');
    const url = new URL(window.location.href);
    const id = url.searchParams.get('id');
    try {
      const response = await fetch(id ? `/dashboard/blogs/${id}` : '/dashboard/blogs', {
        method: 'POST',
        headers: {
          'Authorization': `Bearer ${token}`,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          title,
          description,
          category,
          content
        })
      });

      if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
      }

      const result = await response.json();
      console.log('Blog saved successfully:', result);
      // Redirect to the blogs list page or show a success message
      window.location.href = `/dashboard/blogs/${result.id}`;
    } catch (error) {
      console.error('Error saving blog:', error);
      // Show an error message to the user
      alert('Failed to save the blog. Please try again.');
    }
  });
</script>