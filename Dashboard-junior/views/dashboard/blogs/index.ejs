<div class="container mx-auto px-4 py-8">
  <h1 class="text-3xl font-bold mb-6">Blogs</h1>
  <div id="blogs-container">
    <!-- Initially empty, will be populated by JavaScript -->
  </div>
  <div class="flex justify-center items-center mt-8">
    <a href="/dashboard/blogs/editor" class="btn btn-primary btn-lg">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
      </svg>
      Add New Blog
    </a>
  </div>
</div>

<script>
  const token = localStorage.getItem('authToken');

  async function fetchUserBlogs() {
    try {
      const response = await fetch('/dashboard/blogs/all', {
        method: 'POST',
        headers: {
          'Authorization': `Bearer ${token}`,
          'Content-Type': 'application/json'
        }
      });

      if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
      }

      const contentType = response.headers.get("content-type");
      if (!contentType || !contentType.includes("application/json")) {
        throw new TypeError("Oops, we haven't got JSON!");
      }

      const data = await response.json();
      if (data.length > 0) {
        data.forEach(blog => {
          document.getElementById('blogs-container').innerHTML += `
            <div class="blog-card">
              <h2>${blog.title}</h2>
              <p>${blog.content}</p>
            </div>
          `;
        });
      } else {
        document.getElementById('blogs-container').innerHTML = `
          <div class="bg-yellow-100 border border-yellow-400 text-yellow-700 px-4 py-3 rounded relative" role="alert">
            <strong class="font-bold">No Blogs Found!</strong>
            <span class="block sm:inline"> it's time to create your first blog</span>
          </div>
        `;
      }
    } catch (error) {
      console.error('Error fetching user blogs:', error);
      document.getElementById('blogs-container').innerHTML = `
        <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative" role="alert">
          <strong class="font-bold">Error!</strong>
          <span class="block sm:inline"> Unable to fetch blogs. Please try again later or contact support.</span>
        </div>
      `;
    }
  }

  document.addEventListener('DOMContentLoaded', function() {
    fetchUserBlogs();
  });
</script>